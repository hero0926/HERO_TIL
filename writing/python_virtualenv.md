python virtualenv


python을 깔 때 무심코 같이 깔으려던 virtualenv, 제대로 활용해 본 적이 없다면 이번 기회에 virtualenv가 뭐고 어떻게 활용하는 것인지 알아보도록 한다.



virtualenv : 프로젝트마다 다른 환경설정을 쓸 수 있도록 설정해주는 도구



만약 장고나 플라스크, 등 사이드 패키지가 많은 파이썬 프레임워크를 쓰고 있다면 각각의 디펜던시가 정말 다르다. 

특히 장고 유저라면, 장고 1.대와 2.대가 이게뭔변화여 싶을정도로 url부분에서 큰 변화를 느껴서, 1에서 2로던 2에서 1로던 버전이 차이나게 쓰는 사람은 분명히 헷갈리고 있을 것이다. 바로 내가 urlpatterns 매핑에서 열심히 헷갈리고 있다.

단지 플라스크나 장고와 같은 웹 관련 프레임워크 뿐 아니라 많은 파이썬 프레임워크가 파이썬 버전에 아주 큰 영향을 받는다. 프로젝트별로 사용하는 프레임워크가 달라 환경설정이 따로 필요하다면 꼭 virtualenv를 사용하도록 해야 한다.



mkdir env 등으로 자신이 사용할 환경을 담을 폴더를 만든다
virtualenv project1_env1 로 폴더 안에서 새 환경설정을 만든다
source project1_env/bin/activate 를 하면 우리는 project_1 환경 안으로 들어간다.


이렇게 하면 cmd창 안에 (project_env)	라고 상단에 나타난다.



which python을 해 보면 /users/env/project1_env/bin/python 이라고 뜨며, 물론 which pip 로 확인해보아도 비슷한 결과가 나온다. 현재 우리는 project1_env라는 환경설정 안에 있는 python 버전을 사용하고 있다는 의미이다.



pip list 로 pip 내용을 확인해보면, pip, setuptools만 있다. 자신이 원하는 패키지들을 pip로 설치한다.
pip list 를 다시 확인해보면 자신이 깐 패키지들과 버전 넘버를 확인할 수 있다.
pip freeze --local 을 적용하면, 지금 자신의 가동된 virtualenv안 로컬 디펜던시를 확인할 수 있다. 예를 들어 pip freeze --local > requirements.txt 등으로 활용할 수 있다.
cat requirements.txt 로 내용을 확인해본 후, decactivate 로 virtualenv 를 종료할 수 있다.


만약 종료한 후 다시 whitch python을 해 본다면, /user/anaconda/bin/python 등으로 자신의 컴퓨터에 파이썬을 설치한 파이썬패스를 확인해볼 수 있다.



특정 버전 파이썬으로 환경을 구축하고 싶다면, virtualenv -p /user/bin/python2.6 project_2 식으로 제작한다. 이렇게 하면 파이썬 버전 2.6(물론 로컬 내 깔아둬야만 한다.) 으로 환경을 만들 수 있다.
python --version 으로 버전 확인을 해볼 수 있다.


주의

프로젝트 파일을 virtualenv 프로젝트 폴더에 넣지 말자. 이 폴더들은 단지 환경설정 구축을 위한 것이지 소스 파일을 넣기 위해서가 아니기 때문이다.



virtualenv가 싫고 docker를 쓰겠다.


우리는 docker를 가지고 있다. 물론 virtualenv를 깔아서 써도 되지만, docker를 virtualenv의 대체재로 쓸 수 있다. 환경설정을 관리하는 데는 단지 한 가지가 있는 것이 아니다. pyenv, pyvenv, virtualenv, vagrant 등등이 있었으나 이제 docker가 있다.(빠르다!)



virtualenv 등의 환경 관리자에 문제가 있다면, 아래와 같을 것이다.



호스트 os에 의존적이다
Cpython 모듈 쓰는데 아주 고통스럽다
배쉬창에서 밖에 못한다(이것을 선호하는 사람도 분명 있겠지만 사실 불편하다)
Mutable하다(이것이 장점이라고 생각할수도 있겠지만 고정적으로 쓰고 싶은 환경설정에선 불편하게 된다)


VM을 대신 쓸 수도 있다고 생각할 수 있지만, 문제는 여전히 존재한다.

아주 무겁다
아주 디스크 램 씨피유를 많이 쓴다


Docker 를 사용핟다면, 이런 문제점에서 벗어나서 다양한 os를 지원하는 콘테이너와 많은 라이브러리, 기능을 이용할 수 있다. 또한 전같으면 2기가 먹는 vm을 갖고 고생할걸 몇가지 라이브러리 이미지를 받는것만으로 대체할 수 있는 가벼움도 하나의 큰 이점이다.

10분 정도면 초보자도 파이썬 가상 환경을 도커에 셋업할 수 있다.

그 전에 잠시 도커에 대해 알아보는 시간을 가지도록 한다.

Docker
Docker? : 컨테이너 기반의 오픈소스 가상화 플랫폼



전통적 VM들에서는 서버 호스트 게스트 라이브러리 등을 다 한번에 지고 있는 형식이었기 때문에 아주 많이 느리고 무거웠다.(켜는데 20분도 걸려봤다.) 그러나 Docker는 선착장에서 배들이 짐실어 나르듯 하는 형식이라서 아주 빠르고 가볍다.(켜는데 체감 2분도 안걸린다.) 도커는 전처럼 앱들이 vm위에서 돌아가는 게스트 os와 작용하게 두지 않고, 호스트os의 커널과 작용하도록 도와준다.

docker build 로 이미지를 만든 후, docker run으로 그 이미지에서 컨테이너(running instance)를 만들어 쓴다.

이번에는 도커로 파이썬 가상환경을 구축해 보겠다.



docker ps 로 자신의 실행중인 도커 이미지들을 확인해 본다.(파이썬이 든 이미지가 돌아가고 있는지?)
hub.docker.com에 가서 공식 python이미지를 쉽게 찾을 수 있다. 여러 버전이 있으며 원하는 버전을 받을 수 있다.
docker pull python:3.6등으로 원하는 버전 파이썬을 받아온다.
docker run -it python:3.6 으로 도커 컨테이너 안에 들어간채로 이미지를 실행하면, 해당 버전의 파이썬 인터프리터 확인이 가능하다.
docekr run -it python:3.6 bash 로 해당 환경 내로 접속한채로 이미지 실행이 가능하다
